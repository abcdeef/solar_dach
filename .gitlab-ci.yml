stages:
  - build

build_multi_arch:
  stage: build
  script:
    # QEMU installieren (f√ºr ARM Builds)
    - sudo apt-get update
    - sudo apt-get install -y qemu-user-static

    # Docker Buildx aktivieren
    - docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
    - docker buildx create --use

    # Login bei Docker Hub
    - echo "$DOCKERHUB_TOKEN" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin

    # Multi-Arch Build & Push
    - docker buildx build \
        --platform linux/amd64,linux/arm64 \
        --push \
        -t $DOCKERHUB_USERNAME/mein-image:latest \
        .

  only:
    - main
